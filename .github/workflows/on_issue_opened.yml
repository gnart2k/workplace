name: Auto run local script for new issues

on:
  issues:
    types: [opened]

env:
  LOCAL_PROJECT_PATH: /Users/mac/se/project/kaneo   # <-- your real repo path
  BRANCH_NAME: develop

jobs:
  handle-auto-issue:
    runs-on: self-hosted

    steps:
      - name: Check if issue is auto-created
        if: startsWith(github.event.issue.title, '[auto-created]')
        run: |
          echo "âœ… Auto-created issue detected: ${{ github.event.issue.title }}"

      - name: Pull latest code
        if: startsWith(github.event.issue.title, '[auto-created]')
        run: |
          cd "$LOCAL_PROJECT_PATH"
          echo "ðŸ“¦ Pulling latest code from $BRANCH_NAME..."
          git checkout $BRANCH_NAME
          git pull origin $BRANCH_NAME

      - name: Run opencode task
        if: startsWith(github.event.issue.title, '[auto-created]')
        run: |
          cd "$LOCAL_PROJECT_PATH"
          TITLE="${{ github.event.issue.title }}"
          BODY="${{ github.event.issue.body }}"
          echo "ðŸš€ Running OpenCode task: $TITLE - $BODY"
          opencode run "$TITLE - $BODY"

      - name: Commit and push
        if: startsWith(github.event.issue.title, '[auto-created]')
        run: |
          cd "$LOCAL_PROJECT_PATH"
          echo "ðŸª„ Running OpenCode commit and push..."
          opencode run "commit and push" --continue
